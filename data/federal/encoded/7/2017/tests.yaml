# TDD Test Cases for 7 USC § 2017 (SNAP - Value of Allotment)
#
# These are OUR authoritative tests - derived from statute text.
#
# Sources:
# - Statute: 7 USC § 2017 (value of allotment)
# - Statute: 7 USC § 2014 (eligibility)
# - FY 2024 values: USDA FNS COLA memo

variable: snap_allotment
fiscal_year: 2024

# FY 2024 Parameters (48 states + DC):
#   Maximum allotment (household size):
#     1: $291, 2: $535, 3: $766, 4: $973
#     5: $1,155, 6: $1,386, 7: $1,532, 8: $1,751
#     Each additional: +$219
#   Standard deduction: $198 (1-3 persons), varies for larger
#   Earned income deduction: 20%
#   Net income multiplier: 30% (expected contribution)
#   Shelter cap: $672
#   Minimum benefit (1-2 person): $23
#   Gross income limit: 130% FPL
#   Net income limit: 100% FPL

test_cases:
  # ==========================================================================
  # MAXIMUM ALLOTMENT - Zero net income
  # ==========================================================================

  - name: "1-person household, no income"
    description: "Maximum allotment for single person"
    inputs:
      household_size: 1
      gross_income: 0
      earned_income: 0
      shelter_costs: 0
    expected:
      snap_allotment: 291
    citations:
      - "7 USC § 2017(a): allotment = max - 30% of net income"
      - "FNS FY2024 COLA: max for 1 person = $291"

  - name: "4-person household, no income"
    inputs:
      household_size: 4
      gross_income: 0
      earned_income: 0
      shelter_costs: 0
    expected:
      snap_allotment: 973
    citations:
      - "FNS FY2024 COLA: max for 4 persons = $973"

  - name: "8-person household, no income"
    inputs:
      household_size: 8
      gross_income: 0
      earned_income: 0
      shelter_costs: 0
    expected:
      snap_allotment: 1751
    citations:
      - "FNS FY2024 COLA: max for 8 persons = $1,751"

  # ==========================================================================
  # BENEFIT CALCULATION - With income
  # ==========================================================================

  - name: "1-person, earned income $1000"
    description: |
      Gross: $1000
      Earned deduction: 20% × $1000 = $200
      Standard deduction: $198
      Net income: $1000 - $200 - $198 = $602
      Expected contribution: 30% × $602 = $181 (rounded)
      Allotment: $291 - $181 = $110
    inputs:
      household_size: 1
      gross_income: 1000
      earned_income: 1000
      shelter_costs: 0
    expected:
      snap_allotment: 110
    citations:
      - "7 USC § 2017(a): allotment = max - 30% net income"
      - "7 USC § 2014(e)(1): 20% earned income deduction"

  - name: "4-person, earned income $2000"
    description: |
      Gross: $2000
      Earned deduction: 20% × $2000 = $400
      Standard deduction: ~$198
      Net income: $2000 - $400 - $198 = $1402
      Expected contribution: 30% × $1402 = $421 (rounded)
      Allotment: $973 - $421 = $552
    inputs:
      household_size: 4
      gross_income: 2000
      earned_income: 2000
      shelter_costs: 0
    expected:
      snap_allotment: 552
    citations:
      - "7 USC § 2017(a)"

  - name: "2-person, with shelter costs"
    description: |
      Gross: $1500
      Earned deduction: $300
      Standard deduction: $198
      Adjusted income: $1002
      Shelter deduction: shelter - 50% adjusted
        = $800 - $501 = $299
      Net income: $1002 - $299 = $703
      Expected contribution: 30% × $703 = $211
      Allotment: $535 - $211 = $324
    inputs:
      household_size: 2
      gross_income: 1500
      earned_income: 1500
      shelter_costs: 800
    expected:
      snap_allotment: 324
    citations:
      - "7 USC § 2014(e)(6): excess shelter deduction"

  # ==========================================================================
  # MINIMUM BENEFIT
  # ==========================================================================

  - name: "1-person, high income near cutoff"
    description: "Benefit floors at $23 minimum"
    inputs:
      household_size: 1
      gross_income: 1100
      earned_income: 1100
      shelter_costs: 0
    expected:
      snap_allotment: 23  # minimum benefit
    citations:
      - "7 USC § 2017(a): minimum benefit"
      - "FNS: $23 minimum for 1-2 person households"

  - name: "2-person, high income near cutoff"
    inputs:
      household_size: 2
      gross_income: 1600
      earned_income: 1600
      shelter_costs: 0
    expected:
      snap_allotment: 23  # minimum benefit
    citations:
      - "7 USC § 2017(a): minimum benefit applies to 1-2 person"

  # ==========================================================================
  # INELIGIBLE - Over income limits
  # ==========================================================================

  - name: "1-person, over gross income limit"
    description: "Gross income > 130% FPL = ineligible"
    inputs:
      household_size: 1
      gross_income: 2000  # > 130% FPL (~$1,580 for 1 person)
      earned_income: 2000
      shelter_costs: 0
    expected:
      snap_allotment: 0
    citations:
      - "7 USC § 2014(c): 130% gross income test"

  - name: "4-person, over gross income limit"
    inputs:
      household_size: 4
      gross_income: 4500  # > 130% FPL (~$3,250)
      earned_income: 4500
      shelter_costs: 0
    expected:
      snap_allotment: 0
    citations:
      - "7 USC § 2014(c): gross income eligibility"

  # ==========================================================================
  # ELDERLY/DISABLED - Special rules
  # ==========================================================================

  - name: "1-person elderly, no gross income test"
    description: "Elderly/disabled exempt from gross income test"
    inputs:
      household_size: 1
      gross_income: 1800
      earned_income: 0
      unearned_income: 1800
      shelter_costs: 600
      has_elderly_disabled: true
    expected:
      snap_allotment: 110  # example - calculated based on net only
    citations:
      - "7 USC § 2014(c)(2): elderly/disabled exempt from gross test"
      - "7 USC § 2014(e)(6)(C): uncapped shelter deduction"

  # ==========================================================================
  # EDGE CASES
  # ==========================================================================

  - name: "Zero income, zero shelter"
    inputs:
      household_size: 1
      gross_income: 0
      earned_income: 0
      shelter_costs: 0
    expected:
      snap_allotment: 291
    citations:
      - "Maximum allotment when net income = 0"

  - name: "3-person, mixed income types"
    description: "Earned + unearned income"
    inputs:
      household_size: 3
      gross_income: 2000
      earned_income: 1500
      unearned_income: 500
      shelter_costs: 700
    expected:
      snap_allotment: 450  # approximate
    citations:
      - "7 USC § 2014(e): only earned income gets 20% deduction"

  - name: "Large household (10 persons)"
    description: "8+ uses per-person increment"
    inputs:
      household_size: 10
      gross_income: 0
      earned_income: 0
      shelter_costs: 0
    expected:
      snap_allotment: 2189  # $1,751 + 2×$219
    citations:
      - "FNS: each person beyond 8 adds $219"
